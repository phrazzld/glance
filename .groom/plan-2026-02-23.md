# Grooming Plan — 2026-02-23

## Session Context

- **vision.md** migrated to `project.md` (deleted)
- **New strategic direction added**: zero-friction CI/CD integration
- **No prior retro data** — first grooming session

## Themes Explored

| Theme | Direction Locked |
|-------|-----------------|
| Correctness Foundation | Fix 4 bugs (3 existing, 1 new) blocking output quality |
| CI Integration | Composite GitHub Action in main repo; auto-commit on by default |
| Code Modernization | Existing issues #18, #19, #21 — well-formed, no new issues needed |
| Quality Gates | Existing issues enriched; no new issues needed |

## Issues Created

| # | Title | Score | Notes |
|---|-------|-------|-------|
| #66 | [P1] fix: prevent UTF-8 boundary truncation in TruncateContent | ~85 | New, untracked before |
| #67 | [P2] feat(action): composite GitHub Action for automated glance regeneration | ~80 | New feature, core of CI integration theme |
| #68 | [P2] docs: add CI integration guide and example post-merge workflow | ~80 | Depends on #67 |

## Issues Enriched

| # | Changes Made |
|---|-------------|
| #60 | Full body rewrite + labels (p1, bug, now, effort/s, source/groom, domain/errors) + milestone v1.1 |
| #57 | Labels (p2, task, later, effort/s, source/agent, domain/infra) + Backlog milestone |
| #47 | Backlog milestone |

## Execution Order (Series)

### Track 1: Correctness Foundation (v1.1 milestone, `now`)
1. #51 — relative paths in LLM prompt (P0, effort/s) ← **start here**
2. #53 — sort filenames for deterministic output (P1, effort/s)
3. #60 — fix mutable sentinel errors (P1, effort/s)
4. #66 — fix UTF-8 boundary truncation (P1, effort/s)

### Track 2: CI Integration (Backlog, `next`)
5. #67 — composite GitHub Action (P2, effort/l)
6. #68 — CI integration docs (P2, effort/s)

### Track 3: Quality Gates (Backlog, `next`)
7. #32 — coverage enforcement in CI
8. #33 — secrets scanning automation
9. #57 — pin GitHub Actions to SHAs

### Track 4: Code Modernization (Backlog, `later`)
10. #19 — migrate logrus → log/slog
11. #21 — refactor glance.go
12. #18 — fix testing strategy

## Research Findings (Preserved)

**GitHub Actions distribution pattern:**
- Composite action in `.github/actions/glance/` (main repo) — can extract to dedicated repo later
- Download pre-built binary from GitHub Releases (not `go build`)
- API key via env var (`secrets.GEMINI_API_KEY` → `GEMINI_API_KEY` env)
- Auto-commit via `stefanzweifel/git-auto-commit-action` + `[skip ci]` to prevent loops
- Reference: golangci-lint-action pattern

**Note:** GitHub Issue Types (Bug/Feature/Task) are org-only — not available on personal `phrazzld` account. Skipped.

## Deferred

| Topic | Why Deferred | When to Revisit |
|-------|-------------|----------------|
| Local post-merge hooks | GitHub Actions covers all merges (including web UI); hooks are supplementary | If users request local-only setup |
| Separate `phrazzld/glance-action` repo | Main repo composite action ships faster; extract when usage justifies | If action gains external users |
| #34 (correlation IDs) | Depends on #19 (slog migration); medium effort | After slog migration lands |
| #39 (E2E integration tests) | Large effort; needs real API keys in CI | After reliability track completes |
